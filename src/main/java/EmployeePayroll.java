import java.sql.*;
import java.time.LocalDate;
import java.util.ArrayList;
import java.util.List;

public class EmployeePayroll {

    /**
     * readEmployeePayrollData method to read database data sequentially and returning the
     * arraylist of employees.
     */
    public List<EmployeePayrollData> readEmployeePayrollData() {
        String jdbcUrl = "jdbc:mysql://localhost:3306/employee_payroll_service";
        String username = "root";
        String password = "superstars";
        /*
        Taking an arraylist of type EmployeePayrollData and adding elements to the list one by one using
        constructor of EmployeePayrollData class.
         */
        List<EmployeePayrollData> employeePayrollDataList = new ArrayList<>();
        try {
            System.out.println("Connecting to database " + jdbcUrl);
            /*
            Making connection to the database by giving url,username and password of the database.
             */
            Connection connection = DriverManager.getConnection(jdbcUrl, username, password);
            /*
            If you want to execute a Statement object many times, it usually reduces execution time to use a
             PreparedStatement object instead.In preparedStatement we are execute query for getting data between
             the range of a date 2019-01-01 to the current date.
             */

            PreparedStatement preparedStatement = connection.prepareStatement("select * from employee_payroll where startDate between cast('2019-01-01'AS DATE) AND DATE(NOW()); ");
        /*
        A ResultSet object is a table of data representing a database result set, which is usually generated by executing
        a statement that queries the database.The object of ResultSet maintains a cursor pointing to a row of a table
        */
            ResultSet resultSet = preparedStatement.executeQuery();

        /*
         Adding name,salary and date of the employee in arraylist while resultSet.next() has elements inside
        */
            while (resultSet.next()) {
                /*
                Printing the database tables column with in a particular date range
                 */
                System.out.println(resultSet.getInt("employee_id"));
                System.out.println(resultSet.getString("name"));
                System.out.println(resultSet.getString("salary"));
                System.out.println(resultSet.getDate("startDate").toLocalDate());

                int employeeId = resultSet.getInt("employee_id");
                String name = resultSet.getString("name");
                double salary = resultSet.getDouble("salary");
            /*
            LocalDate is an immutable date-time object that represents a date, often viewed as year-month-day.
            */
                LocalDate startDate = resultSet.getDate("startDate").toLocalDate();
            /*
            Adding the database table in the arraylist for comparing the expected and actual result
            in junit testCases
             */
                employeePayrollDataList.add(new EmployeePayrollData(employeeId, name, salary, startDate));

            }
            connection.close();
        } catch (Exception e) {
            e.printStackTrace();
        }
        return employeePayrollDataList;
    }
}
